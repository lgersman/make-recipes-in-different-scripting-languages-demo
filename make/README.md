# Makefile using make as recipe shell

Just had to try.

## Prerequisites

- GNU make 

## Usage

Change to this directory and execute 

- `make` to populate the database 

## Example code

The Makefile:

```make
# suppress verbose make output
MAKEFLAGS += --silent

# make make the "shell" for make recipes
SHELL = ./make-shell.sh
# empty default shell commandline options to apply for shell invocation
.SHELLFLAGS = make -f -
# => from now on every shell invocation by make will be make

# .ONESHELL tells make to execute a target recipe as a single SHELL call
# (by default make would execute a recipe line by line in separate SHELL calls
.ONESHELL:

all: foo

# for some reason the sub-Makefile has to be indented with two tabs
foo:
	all:
			echo hello from makemake

.PHONY: all
```

The make wrapper file (`make-shell.sh`)

```shell
#!/usr/bin/env bash
# A bash utility script which pipes its last argument to a
# process gained by executing all but its last argument.  Useful in
# Makefiles where you want the recipes to appear on stdin of some
# command other than the usual bash shell.  For example, to write
# recipes in sqlite3 (allowing dot-commands), include the following in your 
# Makefile:
#   SHELL:=sqlite-shell.sh
#   .SHELLFLAGS:=sqlite3 $(DB)
#   .ONESHELL:
# 
# see https://mail.gnu.org/archive/html/help-make/2015-05/msg00017.html
# 
cat <<< "${@:$#}" | "${@:1:$(($# - 1))}"
```

If you run the example by executing `make` in a terminal you will get an greeting from makemake.

```
hello from makemake
```

# Opinionated tip: use `.RECIPEPREFIX`

make is a impressive but stone age old tool with a long history.

At the time of development (=> some decades ago ðŸ˜…) their authors thought it's a good idea to use `'\t'` as recipe prefix.

The result is one of the most asked questions from `make` novices : 

> When executing my Makefile I get the following error
> 
> ```
> Makefile:xx: *** missing separator.  Stop.
> ```
>
> What does that error mean ? 

## What is the recipe prefix ?

A Makefile consists mostly of targets and their recipes. 

A target is usually a file/directory to be generated by the target recipe. 

An example: 

```make
foo.exe: foo.c
  cc -o foo.exe foo.c
```

The recipe prefix is the prefix starting each recipe line. 

__By default it is `'\t'`.__

And that's often a problem - because depending of the used editor / settings tabs may be converted to spaces. 

If you use spaces instead of tabs you get this mysterious error message : 

```
Makefile:xx: *** missing separator.  Stop.
```

## Solution

A solution to workaround that potential issue is to change the recipse prefix to something different : 

```make
# tell make to use '>' as recipe prefix
.RECIPEPREFIX = >

foo.exe: foo.c
> cc -o foo.exe foo.c
```

Now we have a visible character as recipe prefix which is much less error prone.

_The `.RECIPEPREFIX` directive is available since `make` version 4.0._
